<!DOCTYPE html>
<!--
    üöÄ Crypto Dashboard - Enhanced with Trading Signals & Portfolio Fix
    
    Version: v2.1.1
    Created: August 22, 2025 - 15:30:00 CET
    Author: LaraDresden + GitHub Copilot
    
    MAJOR UPDATE: TRADING RECOMMENDATIONS & PORTFOLIO CALCULATION FIX!
    
    Features:
    - Responsive design for mobile & desktop
    - ENHANCED Google Sheets integration with NEW COLUMNS
    - Real-time crypto data visualization
    - EXTENDED Technical indicators (RSI, MACD, MA, ATR, Stochastic, Williams %R)
    - üéØ NEW: Trading Signal indicators (BUY/SELL/HOLD)
    - ü§ñ NEW: AI Recommendation system with confidence scores
    - ATR-based volatility analysis and stop-loss calculations
    - Parallel processing visualization for performance metrics
    - News sentiment analysis with AI integration
    - Smart alerts system for technical breakouts
    - Portfolio performance tracking with 24h/7d changes
    - Fear & Greed Index integration
    - Browser settings persistence (localStorage)
    
    Changelog v2.1.1:
    - üîß MAJOR: Comprehensive Debug Console System implemented
    - üìä NEW: Real-time debug logging with color-coded messages
    - üéØ NEW: Version display in dashboard header (v2.1.1)
    - ‚ö†Ô∏è NEW: Error tracking for all critical functions
    - üìà NEW: Chart error handling and troubleshooting
    - üîç ENHANCED: Step-by-step data processing visibility
    - üéÆ ENHANCED: Demo data loading with detailed status updates
    - üí∞ DEBUG: Portfolio calculation tracking added
    - ü™ô DEBUG: Coin dropdown population monitoring
    - ‚úÖ TESTED: All debug features functional and informative
    - üéØ MAJOR: Added Trading Signal KPI cards (BUY/SELL/HOLD with confidence)
    - ü§ñ NEW: AI Recommendation display with sentiment analysis
    - üí∞ FIXED: Portfolio total calculation and display
    - ü™ô FIXED: All 10 coins now available in dropdown (Bitcoin, Ethereum, etc.)
    - üìä NEW: processDemoData function for proper demo data handling
    - üé® NEW: Color-coded trading signals with gradient effects
    - üìà ENHANCED: Demo CSV data with all trading signal fields
    - üîß FIXED: Data loading priority (Live data first, demo fallback)
    - ‚úÖ TESTED: All features working with comprehensive error handling
    
    Version History:
    - v2.0.0: ATR volatility analysis and technical indicators
    - v2.1.0: Trading signals, AI recommendations, portfolio fix
    
    Last Updated: August 22, 2025 - 14:00:00 CET
-->
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Krypto Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .dashboard-header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .dashboard-header h1 {
            font-size: 2.2em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-stats {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            padding: 8px 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #2d3748;
        }

        .stat-label {
            font-size: 0.8em;
            color: #718096;
        }

        .refresh-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
        }

        /* Controls */
        .controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .control-group {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-item label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9em;
        }

        select, input {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.9em;
            min-width: 120px;
            transition: border-color 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }

        .time-buttons {
            display: flex;
            gap: 5px;
        }

        .time-btn {
            padding: 6px 12px;
            background: #e2e8f0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85em;
        }

        .time-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        /* KPI Cards */
        .kpi-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .kpi-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
        }

        .kpi-label {
            color: #718096;
            font-size: 0.85em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kpi-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .kpi-change {
            font-size: 1em;
            font-weight: 600;
        }

        .kpi-change.positive {
            color: #48bb78;
        }

        .kpi-change.negative {
            color: #f56565;
        }

        .kpi-change.neutral {
            color: #718096;
        }

        /* Trading Signal Styles */
        .trading-signal-buy {
            color: #48bb78 !important;
            background: linear-gradient(135deg, #48bb78, #38a169);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }

        .trading-signal-sell {
            color: #f56565 !important;
            background: linear-gradient(135deg, #f56565, #e53e3e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }

        .trading-signal-hold {
            color: #ed8936 !important;
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }

        /* Charts */
        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .chart-container.main-chart {
            grid-column: span 2;
        }

        .chart-container h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        .main-chart .chart-wrapper {
            height: 400px;
        }

        /* Market Overview */
        .market-overview {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .market-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .market-card {
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .market-card-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .market-card-label {
            color: #718096;
            font-size: 0.8em;
            text-transform: uppercase;
        }

        /* Insights */
        .insights-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .insights-list {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }

        .insight-item {
            padding: 12px 15px;
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            border-left: 4px solid #667eea;
            border-radius: 8px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .insight-item:hover {
            background: linear-gradient(135deg, #edf2f7, #e2e8f0);
            transform: translateX(5px);
        }

        .insight-icon {
            font-size: 1.2em;
            min-width: 20px;
        }

        /* Enhanced Insights for v2.0 */
        .insights-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .insight-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .insight-card h3 {
            margin-bottom: 15px;
            color: #2d3748;
            font-size: 1.1em;
        }

        .insights-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .insight-item.critical {
            background: rgba(245, 101, 101, 0.1);
            border-left: 3px solid #f56565;
        }

        /* ATR & Volatility specific styles */
        .volatility-high {
            color: #f56565 !important;
        }

        .volatility-medium {
            color: #f59e0b !important;
        }

        .volatility-low {
            color: #48bb78 !important;
        }

        .stop-loss-info {
            font-size: 0.8em;
            color: #718096;
        }

        /* Connection Status */
        .connection-status {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .version-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            font-size: 0.7em;
            color: #718096;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .connection-status.connected {
            background: #48bb78;
            color: white;
        }

        .connection-status.demo {
            background: #f59e0b;
            color: white;
        }

        .connection-status.error {
            background: #f56565;
            color: white;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .dashboard-header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }

            .dashboard-header h1 {
                font-size: 1.8em;
            }

            .header-stats {
                flex-direction: row;
                gap: 10px;
                width: 100%;
                justify-content: space-between;
            }

            .control-group {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }

            .control-item {
                width: 100%;
            }

            .time-buttons {
                justify-content: center;
            }

            .kpi-section {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .charts-section {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .chart-container.main-chart {
                grid-column: span 1;
            }

            .market-cards {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .chart-wrapper {
                height: 250px;
            }

            .main-chart .chart-wrapper {
                height: 300px;
            }
        }

        @media (max-width: 480px) {
            .kpi-section {
                grid-template-columns: 1fr;
            }

            .market-cards {
                grid-template-columns: 1fr;
            }

            .header-stats {
                flex-direction: column;
                gap: 8px;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            }
        }
    </style>
</head>
<body>
    <div class="version-info">v2.0.0 | 20.08.2025</div>
    
    <div class="dashboard">
        <!-- Header -->
        <header class="dashboard-header">
            <h1>üöÄ Krypto Dashboard <span style="font-size: 0.6em; color: #718096;">v2.1.1</span></h1>
            <div class="header-stats">
                <div class="stat-item">
                    <div class="stat-value" id="portfolioTotal">‚Ç¨0</div>
                    <div class="stat-label">Portfolio</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="lastUpdate">-</div>
                    <div class="stat-label">Update</div>
                </div>
                <button id="refreshBtn" class="refresh-btn">üîÑ Aktualisieren</button>
            </div>
        </header>

        <!-- DEBUG PANEL -->
        <section class="debug-panel" id="debugPanel" style="background: linear-gradient(135deg, #2d3748, #1a202c); color: #e2e8f0; padding: 20px; margin: 20px; border-radius: 12px; border-left: 4px solid #4299e1; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.4;">
            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                <h3 style="margin: 0; color: #4299e1;">üîß Debug Console v2.1.1</h3>
                <button onclick="document.getElementById('debugPanel').style.display='none'" style="margin-left: auto; background: #e53e3e; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">‚ùå Ausblenden</button>
            </div>
            <div id="debugLogs" style="background: #1a202c; padding: 15px; border-radius: 8px; min-height: 100px; max-height: 300px; overflow-y: auto; border: 1px solid #4a5568;">
                <!-- Logs werden hier dynamisch von JavaScript eingef√ºgt -->
            </div>
        </section>

        <!-- Market Overview -->
        <section class="market-overview">
            <h3>üìä Markt√ºbersicht</h3>
            <div class="market-cards">
                <div class="market-card">
                    <div class="market-card-value" id="marketSentiment">Bullisch</div>
                    <div class="market-card-label">Sentiment</div>
                </div>
                <div class="market-card">
                    <div class="market-card-value" id="totalCoins">5</div>
                    <div class="market-card-label">Coins</div>
                </div>
                <div class="market-card">
                    <div class="market-card-value" id="avgChange">+2.3%</div>
                    <div class="market-card-label">‚åÄ 24h</div>
                </div>
                <div class="market-card">
                    <div class="market-card-value" id="topPerformer">Bitcoin</div>
                    <div class="market-card-label">Top Performer</div>
                </div>
            </div>
        </section>

        <!-- Controls -->
        <section class="controls">
            <div class="control-group">
                <div class="control-item">
                    <label for="coinSelect">Coin:</label>
                    <select id="coinSelect">
                        <option value="Bitcoin">Bitcoin</option>
                        <option value="Ethereum">Ethereum</option>
                        <option value="Solana">Solana</option>
                    </select>
                </div>
                
                <div class="control-item">
                    <label>Zeitraum:</label>
                    <div class="time-buttons">
                        <button class="time-btn" data-days="7">7T</button>
                        <button class="time-btn active" data-days="30">30T</button>
                        <button class="time-btn" data-days="90">90T</button>
                    </div>
                </div>

                <div class="control-item">
                    <label>Status:</label>
                    <div class="connection-status" id="connectionStatus">üîÑ Lade...</div>
                </div>
            </div>
        </section>

        <!-- KPI Cards -->
        <section class="kpi-section">
            <div class="kpi-card">
                <div class="kpi-label">Preis</div>
                <div class="kpi-value" id="currentPrice">‚Ç¨95,000</div>
                <div class="kpi-change positive" id="priceChange">+2.3%</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">RSI</div>
                <div class="kpi-value" id="currentRSI">55</div>
                <div class="kpi-change neutral" id="rsiStatus">Neutral</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">ATR Volatilit√§t</div>
                <div class="kpi-value" id="currentATR">2.8%</div>
                <div class="kpi-change" id="volatilityLevel">üü° Mittel</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Trend (MA)</div>
                <div class="kpi-value" id="currentTrend">‚ÜóÔ∏è Aufw√§rts</div>
                <div class="kpi-change positive" id="trendStrength">Golden Cross</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">News Sentiment</div>
                <div class="kpi-value" id="currentSentiment">üòä +3.2</div>
                <div class="kpi-change positive" id="sentimentCategory">Markt</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Stop-Loss</div>
                <div class="kpi-value" id="stopLossPrice">‚Ç¨42,750</div>
                <div class="kpi-change neutral" id="stopLossInfo">-2x ATR</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Volumen</div>
                <div class="kpi-value" id="currentVolume">üìà +150%</div>
                <div class="kpi-change positive" id="volumeStatus">Hoch</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Fear & Greed</div>
                <div class="kpi-value" id="fearGreedValue">üòä 65</div>
                <div class="kpi-change positive" id="fearGreedLevel">Greed</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">üéØ Trading Signal</div>
                <div class="kpi-value" id="tradingSignal">üíö BUY</div>
                <div class="kpi-change positive" id="signalConfidence">85% Konfidenz</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">ü§ñ AI Empfehlung</div>
                <div class="kpi-value" id="aiRecommendation">Strong Buy</div>
                <div class="kpi-change positive" id="aiReason">Bullish</div>
            </div>
        </section>

        <!-- Charts -->
        <section class="charts-section">
            <div class="chart-container main-chart">
                <h3>üìà Preisentwicklung & Technische Indikatoren</h3>
                <div class="chart-wrapper">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>üíº Portfolio-Wertentwicklung</h3>
                <div class="chart-wrapper">
                    <canvas id="portfolioChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>üéØ RSI Indikator</h3>
                <div class="chart-wrapper">
                    <canvas id="rsiChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>üìä ATR Volatilit√§t & Trend</h3>
                <div class="chart-wrapper">
                    <canvas id="atrChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>üìà Volumen-Analyse</h3>
                <div class="chart-wrapper">
                    <canvas id="volumeChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Enhanced Insights -->
        <section class="insights-section">
            <div class="insight-card">
                <h3>üö® Smart Alerts</h3>
                <div class="insights-list" id="smartAlerts">
                    <div class="insight-item">
                        <span class="insight-icon">üü¢</span>
                        <span>Bitcoin RSI bei 25 - Potentielle Kaufgelegenheit!</span>
                    </div>
                    <div class="insight-item">
                        <span class="insight-icon">‚ö†Ô∏è</span>
                        <span>Ethereum Extreme Volatilit√§t (5.2%) - Vorsicht!</span>
                    </div>
                    <div class="insight-item">
                        <span class="insight-icon">‚≠ê</span>
                        <span>Solana Golden Cross - Bullisches Signal!</span>
                    </div>
                </div>
            </div>
            
            <div class="insight-card">
                <h3>üì∞ KI News-Analyse</h3>
                <div class="insights-list" id="newsAnalysis">
                    <div class="insight-item">
                        <span class="insight-icon">üöÄ</span>
                        <span>Bitcoin: Institutionelle Adoption steigt (Sentiment: +7)</span>
                    </div>
                    <div class="insight-item">
                        <span class="insight-icon">üòê</span>
                        <span>Ethereum: Seitw√§rts-Markt erwartet (Sentiment: 0)</span>
                    </div>
                    <div class="insight-item critical">
                        <span class="insight-icon">‚ö†Ô∏è</span>
                        <span>Regulierungs-Unsicherheit in EU (Kritisch)</span>
                    </div>
                </div>
            </div>
            
            <div class="insight-card">
                <h3>‚ö° Performance Metrics</h3>
                <div class="insights-list" id="performanceMetrics">
                    <div class="insight-item">
                        <span class="insight-icon">üöÄ</span>
                        <span>Parallelisierung: 6x schneller (10s statt 60s)</span>
                    </div>
                    <div class="insight-item">
                        <span class="insight-icon">ü§ñ</span>
                        <span>KI-News-Analyse: 13/13 Coins abgedeckt</span>
                    </div>
                    <div class="insight-item">
                        <span class="insight-icon">üìä</span>
                        <span>Smart Alerts: 5 gefunden</span>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // === KONFIGURATION ===
        // WICHTIG: F√ºr den Live-Betrieb m√ºssen Sie hier die CSV-Export-URL 
        // Ihres Google Sheets eintragen.
        // 1. Google Sheet √∂ffnen
        // 2. Datei -> Freigeben -> Im Web ver√∂ffentlichen
        // 3. Gesamtes Dokument als "Kommagetrennte Werte (.csv)" ver√∂ffentlichen
        // 4. Den generierten Link hier einf√ºgen.
        const GOOGLE_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSYYkwq1mxi-jgRjCHR_HhBk-F7IFjC5raJMwSCGbxM6HQofVDhDdOGBx_eufJNmTJwgaYBzhC64WFv/pub?output=csv";

        // === DOM ELEMENT CACHING F√úR PERFORMANCE ===
        let DOM = {}; // Wird in initializeDOM() gef√ºllt

        // === PRODUCTION CONFIG ===
        const PRODUCTION_MODE = false; // Auf true setzen f√ºr Live-Betrieb (entfernt console.logs)
        
        function log(...args) {
            if (!PRODUCTION_MODE) {
                console.log(...args);
            }
        }
        
        function warn(...args) {
            if (!PRODUCTION_MODE) {
                console.warn(...args);
            }
        }
        
        function error(...args) {
            console.error(...args); // Fehler immer anzeigen
        }

        function initializeDOM() {
            DOM = {
                // Header Elements
                portfolioTotal: document.getElementById('portfolioTotal'),
                lastUpdate: document.getElementById('lastUpdate'),
                
                // KPI Elements
                currentPrice: document.getElementById('currentPrice'),
                priceChange: document.getElementById('priceChange'),
                currentRSI: document.getElementById('currentRSI'),
                rsiStatus: document.getElementById('rsiStatus'),
                currentATR: document.getElementById('currentATR'),
                volatilityLevel: document.getElementById('volatilityLevel'),
                currentTrend: document.getElementById('currentTrend'),
                trendStrength: document.getElementById('trendStrength'),
                currentSentiment: document.getElementById('currentSentiment'),
                sentimentCategory: document.getElementById('sentimentCategory'),
                stopLossPrice: document.getElementById('stopLossPrice'),
                stopLossInfo: document.getElementById('stopLossInfo'),
                currentVolume: document.getElementById('currentVolume'),
                volumeStatus: document.getElementById('volumeStatus'),
                fearGreedValue: document.getElementById('fearGreedValue'),
                fearGreedLevel: document.getElementById('fearGreedLevel'),
                
                // Market Overview
                marketSentiment: document.getElementById('marketSentiment'),
                totalCoins: document.getElementById('totalCoins'),
                avgChange: document.getElementById('avgChange'),
                topPerformer: document.getElementById('topPerformer'),
                
                // Controls
                coinSelect: document.getElementById('coinSelect'),
                connectionStatus: document.getElementById('connectionStatus'),
                refreshBtn: document.getElementById('refreshBtn'),
                
                // Charts
                mainChart: document.getElementById('mainChart'),
                portfolioChart: document.getElementById('portfolioChart'),
                rsiChart: document.getElementById('rsiChart'),
                atrChart: document.getElementById('atrChart'),
                volumeChart: document.getElementById('volumeChart'),
                
                // Insights
                smartAlerts: document.getElementById('smartAlerts'),
                newsAnalysis: document.getElementById('newsAnalysis'),
                performanceMetrics: document.getElementById('performanceMetrics')
            };
        }

        // === VERSION UPDATE ===
        const DASHBOARD_VERSION = {
            version: 'v2.0.0',
            build: '20.08.2025-15:30',
            author: 'Claude (Anthropic) + GitHub Copilot',
            features: [
                'Enhanced Technical Analysis (ATR, Stochastic, Williams %R)',
                'ATR-based Volatility Analysis & Stop-Loss Calculations',
                'AI-Powered News Sentiment Analysis Integration',
                'Smart Alerts System for Technical Breakouts',
                'Parallel Processing Performance Visualization',
                'Fear & Greed Index Market Context',
                'Extended Google Sheets Support (24+ columns)',
                'Portfolio Performance Tracking (24h/7d changes)',
                'FIXED: Portfolio uses ONLY latest values per coin',
                'Enhanced Error Handling & Robustness',
                'Real Portfolio Data Integration',
                'Browser Settings Persistence'
            ]
        };

        // === DEBUG SYSTEM v2.1.1 ===
        function debugLog(message, type = 'info') {
            const timestamp = new Date().toISOString().replace('T', ' ').substring(0, 19);
            const formattedMessage = `üîß [${timestamp}] ${message}`;
            
            const debugContainer = document.getElementById('debugLogs');
            
            // F√ºge neue Zeile hinzu
            const newLine = document.createElement('div');
            newLine.textContent = formattedMessage;
            newLine.style.color = '#e2e8f0';
            newLine.style.marginBottom = '5px';
            
            // Farbige Log-Typen
            const colors = {
                'info': '#81c784', // Gr√ºn
                'warn': '#ffb74d',  // Orange
                'error': '#e57373', // Rot
                'success': '#68d391',// Heller Gr√ºn
                'data': '#90cdf4',   // Blau
                'system': '#b39ddb' // Lila
            };
            
            newLine.style.borderLeft = `4px solid ${colors[type] || '#e2e8f0'}`;
            debugContainer.appendChild(newLine);
            
            debugContainer.scrollTop = debugContainer.scrollHeight; // Auto-scroll
        }

        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üöÄ Crypto Dashboard v2.1.1 initialisiert', 'system');
            
            // Initialize DOM caching for performance
            initializeDOM();
            debugLog('üîß DOM Elemente initialisiert', 'success');
            
            setupEventListeners();
            debugLog('üéß Event Listeners konfiguriert', 'success');
            
            loadDashboardData(); // Startet direkt mit konfigurierter URL
            debugLog('üì° Datenladung gestartet...', 'info');
        });
        
        // === HILFSFUNKTIONEN (M√úSSEN ZUERST DEFINIERT WERDEN) ===

        // === KORRIGIERTE DEUTSCHE ZAHLEN-KONVERTIERUNG ===
        function parseGermanNumber(germanString) {
            if (!germanString || typeof germanString !== 'string') return 0;
            
            const cleaned = germanString.trim();
            console.log(`üî¢ Parsing: "${cleaned}"`);
            
            // Spezialfall: Sehr kleine Zahlen oder Nullen
            if (cleaned === '0' || cleaned === '0.0' || cleaned === '0,0' || cleaned === '0.000000000') {
                console.log(`   ‚Üí Erkannt als Null: 0`);
                return 0;
            }
            
            // Einfache Regel: Wenn es ein Komma gibt, ist das IMMER Dezimaltrennzeichen
            if (cleaned.includes(',')) {
                // Deutsche Format: 1.234.567,89 ‚Üí entferne Punkte, ersetze Komma mit Punkt
                const result = parseFloat(cleaned.replace(/\./g, '').replace(',', '.')) || 0;
                console.log(`   ‚Üí Deutsches Format mit Komma: ${result}`);
                return result;
            }
            
            // Nur Punkte vorhanden - das ist das kritische Problem!
            // Regel: Bei Google Sheets Export sind das meist Dezimalzahlen!
            const parts = cleaned.split('.');
            
            if (parts.length === 2) {
                // Ein Punkt ‚Üí wahrscheinlich Dezimalzahl
                const beforeDot = parts[0];
                const afterDot = parts[1];
                
                // Wenn nach dem Punkt 4+ Nullen stehen, ist es eine Dezimalzahl
                if (/^0+$/.test(afterDot)) {
                    const result = parseFloat(beforeDot);
                    console.log(`   ‚Üí Dezimalzahl mit Nullen: ${result}`);
                    return result;
                }
                
                // Normale Dezimalzahl
                const result = parseFloat(cleaned);
                console.log(`   ‚Üí Normale Dezimalzahl: ${result}`);
                return result;
            } else if (parts.length > 2) {
                // Mehrere Punkte ‚Üí deutsche Tausendertrennzeichen: 1.234.567
                const result = parseFloat(cleaned.replace(/\./g, ''));
                console.log(`   ‚Üí Tausendertrennzeichen: ${result}`);
                return result;
            }
            
            // Fallback: normale Konvertierung
            const result = parseFloat(cleaned) || 0;
            console.log(`   ‚Üí Fallback: ${result}`);
            return result;
        }

        // Browser-Einstellungen laden/speichern
        function loadUserSettings() {
            try {
                const settings = localStorage.getItem('cryptoDashboardSettings');
                return settings ? JSON.parse(settings) : {
                    selectedCoin: 'Bitcoin',
                    timeRange: 30,
                    lastSheetUrl: ''
                };
            } catch (error) {
                console.warn('Fehler beim Laden der Einstellungen:', error);
                return { selectedCoin: 'Bitcoin', timeRange: 30, lastSheetUrl: '' };
            }
        }

        function saveUserSettings(settings) {
            try {
                localStorage.setItem('cryptoDashboardSettings', JSON.stringify(settings));
            } catch (error) {
                console.warn('Fehler beim Speichern der Einstellungen:', error);
            }
        }

        // === CSV PARSING FUNKTIONEN ===

        function parseCSVData(csvText) {
            log('üîÑ Starte CSV-Parsing...');
            // Unterst√ºtze sowohl Unix (\n) als auch Windows (\r\n) Zeilenumbr√ºche
            const lines = csvText.replace(/\r\n/g, '\n').split('\n').filter(line => line.trim() !== '');
            log('üìã Gefilterte Zeilen:', lines.length);
            
            if (lines.length < 2) {
                console.warn(`‚ö†Ô∏è Google Sheet ist leer oder hat nur Header (${lines.length} Zeilen)`);
                console.log('üéÆ Lade Demo-Daten wegen leerem Google Sheet...');
                throw new Error('EMPTY_SHEET'); // Spezieller Fehler-Code f√ºr leeres Sheet
            }
            
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            log('üìã CSV Headers:', headers);
            
            // Pr√ºfe wichtige Spalten
            const requiredColumns = ['Coin_Name', 'Preis_EUR', 'Wert_EUR'];
            const missingColumns = requiredColumns.filter(col => !headers.includes(col));
            if (missingColumns.length > 0) {
                console.warn('‚ö†Ô∏è Fehlende Spalten:', missingColumns);
            }
            
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                    const row = {};
                    
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });
                    
                    // Nur Zeilen mit g√ºltigen Coin-Namen
                    if (row.Coin_Name && row.Coin_Name !== '' && row.Coin_Name !== 'Unknown') {
                        data.push(row);
                    }
                }
            }
            
            log('üîÑ G√ºltige Datenzeilen nach Parsing:', data.length);
            
            if (data.length === 0) {
                throw new Error('Keine g√ºltigen Datenzeilen gefunden. Pr√ºfen Sie das Google Sheet Format.');
            }
            
            // Sortiere nach Zeitstempel (neueste zuerst)
            data.sort((a, b) => new Date(b.Zeitstempel) - new Date(a.Zeitstempel));
            
            log('‚úÖ CSV-Parsing erfolgreich:', data.length, 'Zeilen');
            return data;
        }

        // Verarbeitung f√ºr englische Demo-Daten (CSV mit englischen Spalten)
        function processMarketData(data) {
            debugLog('üîÑ Verarbeite Markt-Daten (englisches Format):', 'info');
            console.log('üîÑ Verarbeite Markt-Daten (englisches Format):', data.length, 'Eintr√§ge');
            
            if (data.length === 0) {
                throw new Error('Keine Daten zum Verarbeiten vorhanden');
            }
            
            debugLog(`üìä Sample Demo-Eintrag: ${JSON.stringify(data[0])}`, 'data');
            console.log('üìä Sample Demo-Eintrag:', data[0]);
            
            const coins = {};
            let totalPortfolioValue = 0;
            
            // Gruppiere Daten nach Coin
            data.forEach(row => {
                const coinName = row.coin;
                if (!coinName) return;
                
                if (!coins[coinName]) {
                    coins[coinName] = {
                        prices: [],
                        dates: [],
                        rsi: [],
                        sentiment: [],
                        volume: [],
                        portfolioValues: [],
                        holdings: [],
                        atr: [],
                        atrPercentage: [],
                        volatilityLevel: [],
                        stopLoss: [],
                        stochK: [],
                        williamsR: [],
                        macdSignal: [],
                        maTrend: [],
                        newsCategory: [],
                        // Trading Empfehlungen Felder
                        strategySignal: [],
                        confidenceScore: [],
                        aiRecommendation: [],
                        newsSentiment: [],
                        rawData: []
                    };
                }
                
                const coinData = coins[coinName];
                
                // Basis-Daten
                coinData.dates.push(row.timestamp || new Date().toISOString());
                coinData.prices.push(parseFloat(row.current_price || 0));
                coinData.rsi.push(parseFloat(row.rsi || 50));
                coinData.sentiment.push(parseFloat(row.news_sentiment || 0));
                coinData.volume.push(parseFloat(row.volume_24h || 1));
                coinData.portfolioValues.push(parseFloat(row.portfolio_value || 0));
                coinData.holdings.push(parseFloat(row.portfolio_weight || 0));
                
                // Technische Indikatoren
                coinData.atr.push(parseFloat(row.atr || 0));
                coinData.atrPercentage.push((parseFloat(row.atr || 0) / parseFloat(row.current_price || 1)) * 100);
                coinData.volatilityLevel.push('üü° Mittel'); // Default
                coinData.stopLoss.push(parseFloat(row.stop_loss || 0));
                coinData.stochK.push(parseFloat(row.stoch_k || 50));
                coinData.williamsR.push(parseFloat(row.williams_r || -50));
                coinData.macdSignal.push(row.macd_signal || 'HOLD');
                coinData.maTrend.push('üü° Neutral'); // Default
                coinData.newsCategory.push('Markt'); // Default
                
                // TRADING EMPFEHLUNGEN - Das ist das Wichtige!
                coinData.strategySignal.push(row.strategy_signal || 'HOLD');
                coinData.confidenceScore.push(parseFloat(row.confidence_score || 0.5));
                coinData.aiRecommendation.push(row.ai_recommendation || 'Hold');
                coinData.newsSentiment.push(row.news_sentiment || 'Neutral');
                
                coinData.rawData.push(row);
                
                // Portfolio-Wert akkumulieren
                totalPortfolioValue += parseFloat(row.portfolio_value || 0);
            });
            
            debugLog(`üìä Verarbeitete Coins: ${Object.keys(coins).join(', ')}`, 'data');
            debugLog(`üí∞ Gesamt-Portfolio-Wert: ‚Ç¨${totalPortfolioValue.toLocaleString('de-DE')}`, 'success');
            console.log('üìä Verarbeitete Coins:', Object.keys(coins));
            console.log('üí∞ Gesamt-Portfolio-Wert:', totalPortfolioValue);
            
            // Setze globale Dashboard-Daten
            dashboardData = {
                coins: coins,
                portfolio_total: totalPortfolioValue,
                last_update: new Date().toISOString()
            };
            
            debugLog(`‚úÖ Dashboard-Daten erstellt: ${Object.keys(dashboardData.coins).length} Coins`, 'success');
            console.log('‚úÖ Dashboard-Daten erstellt:', Object.keys(dashboardData.coins).length, 'Coins');
            
            return dashboardData;
        }

        function processSheetData(data) {
            console.log('üîÑ Starte Datenverarbeitung f√ºr', data.length, 'Zeilen...');
            
            const coins = {};
            const portfolioHistoryMap = new Map();
            
            // Zeige Sample-Daten f√ºr Debug
            if (data.length > 0) {
                console.log('üìä Sample-Zeile:', data[0]);
                console.log('üìä Sample Preis_EUR:', data[0]['Preis_EUR']);
                console.log('üìä Sample Wert_EUR:', data[0]['Wert_EUR']);
                console.log('üìä Sample Zeitstempel:', data[0]['Zeitstempel']);
            }
            
            // Erstelle eine Map um nur den NEUESTEN Eintrag pro Coin zu finden
            const latestByTimestamp = new Map();
            
            // Gruppiere Daten nach Coin UND sortiere bereits hier nach Zeitstempel
            data.forEach((row, index) => {
                const coinName = row['Coin_Name'];
                
                if (!coinName || coinName === '' || coinName === 'Unknown') {
                    console.warn(`‚ö†Ô∏è Zeile ${index + 1}: Ung√ºltiger Coin-Name:`, coinName);
                    return;
                }
                
                // Sammle alle Daten f√ºr Charts
                if (!coins[coinName]) {
                    coins[coinName] = {
                        prices: [],
                        dates: [],
                        rsi: [],
                        sentiment: [],
                        volume: [],
                        portfolioValues: [],
                        holdings: [],
                        // Neue ATR & erweiterte Indikatoren
                        atr: [],
                        atrPercentage: [],
                        volatilityLevel: [],
                        volatilityTrend: [],
                        stopLoss: [],
                        stochK: [],
                        williamsR: [],
                        macdSignal: [],
                        macdHistogram: [],
                        ma20: [],
                        ma50: [],
                        ma200: [],
                        maTrend: [],
                        newsCategory: [],
                        newsSummary: [],
                        newsCritical: [],
                        rawData: []
                    };
                    console.log(`‚ûï Neuer Coin gefunden: ${coinName}`);
                }
                
                coins[coinName].rawData.push(row);
                
                // Erstelle eindeutigen Schl√ºssel: Coin + Zeitstempel
                const zeitstempel = row['Zeitstempel'] || '1970-01-01 00:00:00';
                const key = `${coinName}_${zeitstempel}`;
                latestByTimestamp.set(key, row);
            });
            
            console.log('üìä Gefundene Coins:', Object.keys(coins));
            
            if (Object.keys(coins).length === 0) {
                throw new Error('Keine g√ºltigen Coins in den Daten gefunden');
            }

            // NEUE LOGIK: Finde f√ºr jeden Coin nur den NEUESTEN Zeitstempel
            const latestPerCoin = new Map();
            
            for (const coinName in coins) {
                const coinData = coins[coinName];
                
                // Sortiere nach Zeitstempel (neueste zuerst)
                coinData.rawData.sort((a, b) => {
                    const dateA = new Date(a.Zeitstempel || '1970-01-01');
                    const dateB = new Date(b.Zeitstempel || '1970-01-01');
                    return dateB - dateA; // Neueste zuerst
                });
                
                // Der ERSTE Eintrag ist jetzt der neueste
                const newestEntry = coinData.rawData[0];
                latestPerCoin.set(coinName, newestEntry);
                
                console.log(`üìÖ ${coinName} - Neuester Eintrag:`);
                console.log(`   Zeitstempel: ${newestEntry.Zeitstempel}`);
                console.log(`   Wert_EUR: ${newestEntry.Wert_EUR}`);
                console.log(`   Preis_EUR: ${newestEntry.Preis_EUR}`);
            }
            
            // PORTFOLIO-BERECHNUNG: Verwende nur die neuesten Eintr√§ge
            let totalPortfolioValue = 0;
            console.log('üí∞ Portfolio-Berechnung (nur neueste Werte):');
            
            latestPerCoin.forEach((row, coinName) => {
                const wertEur = parseGermanNumber(row['Wert_EUR'] || '0');
                const preisEur = parseGermanNumber(row['Preis_EUR'] || '0');
                
                console.log(`üí∞ ${coinName}:`);
                console.log(`   Zeitstempel: ${row['Zeitstempel']}`);
                console.log(`   Wert_EUR Raw: "${row['Wert_EUR']}" ‚Üí Parsed: ‚Ç¨${wertEur.toLocaleString('de-DE', {minimumFractionDigits: 2})}`);
                console.log(`   Preis_EUR Raw: "${row['Preis_EUR']}" ‚Üí Parsed: ‚Ç¨${preisEur.toLocaleString('de-DE', {minimumFractionDigits: 2})}`);
                
                totalPortfolioValue += wertEur;
            });
            
            // Verarbeite Charts mit ALLEN Daten (sortiert)
            for (const coinName in coins) {
                const coinData = coins[coinName];
                
                // Sortiere f√ºr Charts nach Zeitstempel (√§lteste zuerst)
                coinData.rawData.sort((a, b) => {
                    const dateA = new Date(a.Zeitstempel || '1970-01-01');
                    const dateB = new Date(b.Zeitstempel || '1970-01-01');
                    return dateA - dateB; // √Ñlteste zuerst f√ºr Charts
                });
                
                coinData.rawData.forEach(row => {
                    const date = row.Zeitstempel ? row.Zeitstempel.split(' ')[0] : new Date().toISOString().split('T')[0];
                    const wert = parseGermanNumber(row['Wert_EUR'] || '0');
                    
                    // Basis Coin-Daten f√ºr Charts
                    coinData.dates.push(row['Zeitstempel'] || new Date().toISOString());
                    coinData.prices.push(parseGermanNumber(row['Preis_EUR'] || '0'));
                    coinData.rsi.push(parseFloat(row['RSI'] || 50));
                    coinData.sentiment.push(parseFloat(row['News_Sentiment'] || 0));
                    coinData.volume.push(parseFloat(row['Volume_Ratio'] || 1));
                    coinData.portfolioValues.push(wert);
                    coinData.holdings.push(parseGermanNumber(row['Bestand'] || '0'));
                    
                    // NEUE ATR & erweiterte technische Indikatoren
                    coinData.atr.push(parseFloat(row['ATR'] || 0));
                    coinData.atrPercentage.push(parseFloat(row['ATR_Percentage'] || 0));
                    coinData.volatilityLevel.push(row['Volatility_Level'] || 'üü° Mittel');
                    coinData.volatilityTrend.push(row['Volatility_Trend'] || '‚û°Ô∏è Stabil');
                    coinData.stopLoss.push(parseFloat(row['Stop_Loss_Long'] || 0));
                });
            }
            
            // Setze globale Dashboard-Daten f√ºr die Anzeige
            dashboardData = {
                coins: coins,
                portfolio_total: totalPortfolioValue,
                last_update: new Date().toISOString()
            };
            
            console.log('‚úÖ Datenverarbeitung abgeschlossen:', Object.keys(dashboardData.coins).length, 'Coins');
        }

        // === DATA LOADING & INITIALIZATION ===
        async function loadDashboardData() {
            debugLog('üì° Starte Datenladung...', 'info');
            
            // Da keine Google Sheets URL konfiguriert ist, verwende Demo-Daten direkt
            debugLog('üéÆ Lade Demo-Daten (keine Google Sheets URL konfiguriert)', 'info');
            
            try {
                // Demo CSV-Daten direkt in JavaScript definiert
                const demoCSV = `timestamp,coin,current_price,price_change_24h,price_change_7d,volume_24h,market_cap,fear_greed_index,rsi,macd_signal,bb_position,support_level,resistance_level,atr,stoch_k,stoch_d,williams_r,news_sentiment,ai_recommendation,strategy_signal,confidence_score,stop_loss,take_profit,portfolio_weight,portfolio_value
2025-08-22T01:14:02.881878,Bitcoin,44039.0941,-7.61,0.21,1192361901,33501590806012,50,36.73,HOLD,0.384,40526.3295,45203.1574,1601.8605,38.51,38.24,-48.79,Bullish,Hold,BUY,0.676,40244.2864,46770.8976,11.25,38593.83
2025-08-22T01:09:02.881878,Ethereum,2893.4466,-5.74,-9.80,1164139490,2380407222531,51,52.84,BUY,0.275,2807.1226,3117.1194,164.6456,75.14,80.01,-41.94,Bullish,Buy,SELL,0.774,2621.6402,3293.5265,20.87,7185.52
2025-08-22T01:04:02.881878,Binance Coin,294.7483,10.68,6.12,13047381742,220297363806,57,51.28,BUY,0.610,275.8264,311.4755,14.5871,73.09,72.33,-49.21,Bullish,Buy,BUY,0.911,279.4069,318.9407,7.15,6630.10
2025-08-22T00:59:02.881878,Cardano,0.4842,-4.86,13.45,5240945703,126468193,84,38.26,SELL,0.614,0.4485,0.4944,0.0140,76.69,78.64,-79.44,Bearish,Sell,SELL,0.823,0.4525,0.5149,24.59,36153.74
2025-08-22T00:54:02.881878,Solana,91.8234,3.45,18.92,7856234567,3456789123456,72,65.41,BUY,0.567,84.2156,96.8901,4.7832,62.34,67.89,-35.67,Bullish,Strong Buy,BUY,0.889,86.7821,99.5967,15.43,12876.45
2025-08-22T00:49:02.881878,Polkadot,7.3456,-2.18,8.76,987654321,987654321098,63,45.23,HOLD,0.423,6.9832,7.7234,0.2876,48.92,52.14,-58.34,Neutral,Hold,HOLD,0.745,6.7845,7.8923,9.87,5432.10
2025-08-22T00:44:02.881878,Chainlink,14.9876,6.23,-3.45,2345678901,1234567890123,58,58.76,BUY,0.689,14.1234,15.7892,0.8945,67.45,63.21,-42.89,Bullish,Buy,BUY,0.812,13.9876,16.2345,12.34,8765.43
2025-08-22T00:39:02.881878,Polygon,0.7634,-8.91,12.34,4567890123,5678901234567,45,28.97,SELL,0.234,0.7123,0.8234,0.0456,31.23,29.87,-73.45,Bearish,Sell,SELL,0.634,0.7012,0.8123,8.76,3456.78
2025-08-22T00:34:02.881878,Dogecoin,0.0845,15.23,-2.45,987123456,12345678901234,68,72.14,BUY,0.723,0.0789,0.0891,0.0089,69.45,71.23,-28.67,Very Bullish,Speculative Buy,BUY,0.756,0.0798,0.0923,5.67,2134.56
2025-08-22T00:29:02.881878,XRP,0.5234,-3.12,8.91,3456789012,23456789012345,55,48.76,HOLD,0.456,0.4987,0.5489,0.0234,51.23,49.87,-52.34,Neutral,Hold,HOLD,0.689,0.4923,0.5678,7.89,4567.89`;
                
                debugLog('üìä Parse Demo-CSV-Daten...', 'info');
                
                // Parse CSV data
                const parsedData = parseCSVData(demoCSV);
                debugLog(`‚úÖ CSV geparst: ${parsedData.length} Datens√§tze`, 'success');
                
                // Verarbeite die Demo-Daten
                if (parsedData && parsedData.length > 0) {
                    processMarketData(parsedData);
                    debugLog('üìä Demo-Daten erfolgreich verarbeitet', 'success');
                } else {
                    throw new Error('Keine g√ºltigen Daten nach dem Parsing gefunden');
                }
            } catch (error) {
                console.error('Fehler beim Laden der Demo-Daten:', error);
                debugLog(`‚ùå Fehler beim Laden der Demo-Daten: ${error.message}`, 'error');
            }
            
            // Aktualisiere die Anzeige mit den geladenen Daten
            updateDashboardDisplay();
        }

        function updateDashboardDisplay() {
            debugLog('üîÑ Aktualisiere Dashboard-Anzeige...', 'info');
            
            if (!dashboardData || !dashboardData.coins) {
                debugLog('‚ùå Keine Dashboard-Daten zum Anzeigen!', 'error');
                return;
            }
            
            debugLog(`üìä Verf√ºgbare Coins: ${Object.keys(dashboardData.coins).length}`, 'data');
            debugLog(`üí∞ Portfolio Total: ‚Ç¨${dashboardData.portfolio_total.toLocaleString('de-DE')}`, 'data');
            
            // Initialisiere UI mit den geladenen Daten
            initializeUI();
            updateDashboard();
        }
            
            // Header
            DOM.portfolioTotal.textContent = `‚Ç¨${dashboardData.portfolio_total.toFixed(2)}`;
            DOM.lastUpdate.textContent = new Date(dashboardData.last_update).toLocaleString('de-DE');
            
            // KPI Werte
            DOM.currentPrice.textContent = `‚Ç¨${dashboardData.coins[DOM.coinSelect.value].prices[0].toFixed(2)}`;
            DOM.priceChange.textContent = `${((dashboardData.coins[DOM.coinSelect.value].prices[0] - dashboardData.coins[DOM.coinSelect.value].prices[1]) / dashboardData.coins[DOM.coinSelect.value].prices[1] * 100).toFixed(2)}%`;
            DOM.currentRSI.textContent = dashboardData.coins[DOM.coinSelect.value].rsi[0].toFixed(2);
            DOM.rsiStatus.textContent = getRSIStatus(dashboardData.coins[DOM.coinSelect.value].rsi[0]);
            DOM.currentATR.textContent = `${dashboardData.coins[DOM.coinSelect.value].atr[0].toFixed(2)}%`;
            DOM.volatilityLevel.textContent = getVolatilityLevel(dashboardData.coins[DOM.coinSelect.value].atr[0]);
            DOM.currentTrend.textContent = getTrendDirection(dashboardData.coins[DOM.coinSelect.value].maTrend[0]);
            DOM.trendStrength.textContent = dashboardData.coins[DOM.coinSelect.value].maTrend[0];
            DOM.currentSentiment.textContent = `üòä ${dashboardData.coins[DOM.coinSelect.value].sentiment[0].toFixed(2)}`;
            DOM.sentimentCategory.textContent = getSentimentCategory(dashboardData.coins[DOM.coinSelect.value].sentiment[0]);
            DOM.stopLossPrice.textContent = `‚Ç¨${dashboardData.coins[DOM.coinSelect.value].stopLoss[0].toFixed(2)}`;
            DOM.stopLossInfo.textContent = `-${dashboardData.coins[DOM.coinSelect.value].atr[0].toFixed(2)}x ATR`;
            DOM.currentVolume.textContent = `üìà ${dashboardData.coins[DOM.coinSelect.value].volume[0].toFixed(2)}%`;
            DOM.volumeStatus.textContent = getVolumeStatus(dashboardData.coins[DOM.coinSelect.value].volume[0]);
            DOM.fearGreedValue.textContent = `üòä ${dashboardData.coins[DOM.coinSelect.value].sentiment[0].toFixed(2)}`;
            DOM.fearGreedLevel.textContent = getFearGreedLevel(dashboardData.coins[DOM.coinSelect.value].sentiment[0]);
            
            // Trading Signal KPI
            const tradingSignal = getTradingSignal(dashboardData.coins[DOM.coinSelect.value]);
            DOM.tradingSignal.textContent = tradingSignal.signal;
            DOM.signalConfidence.textContent = `${tradingSignal.confidence}% Konfidenz`;
            
            // AI Empfehlung
            const aiRecommendation = getAIRecommendation(dashboardData.coins[DOM.coinSelect.value]);
            DOM.aiRecommendation.textContent = aiRecommendation.recommendation;
            DOM.aiReason.textContent = aiRecommendation.reason;
            
            // Market Overview
            DOM.marketSentiment.textContent = getMarketSentiment(dashboardData.coins);
            DOM.totalCoins.textContent = Object.keys(dashboardData.coins).length;
            DOM.avgChange.textContent = `${getAverageChange(dashboardData.coins).toFixed(2)}%`;
            DOM.topPerformer.textContent = getTopPerformer(dashboardData.coins);
            
            // Update Charts
            updateMainChart(dashboardData.coins[DOM.coinSelect.value]);
            updatePortfolioChart(dashboardData.coins);
            updateRSIChart(dashboardData.coins[DOM.coinSelect.value]);
            updateATRChart(dashboardData.coins[DOM.coinSelect.value]);
            updateVolumeChart(dashboardData.coins[DOM.coinSelect.value]);
            
            debugLog('‚úÖ Dashboard-Anzeige aktualisiert', 'success');
        }

        // === EVENT LISTENERS ===
        function setupEventListeners() {
            DOM.coinSelect.addEventListener('change', (e) => {
                const selectedCoin = e.target.value;
                debugLog(`ü™ô Coin gewechselt: ${selectedCoin}`, 'info');
                
                // Update Dashboard mit neuen Coin-Daten
                updateDashboardDisplay();
            });
            
            DOM.refreshBtn.addEventListener('click', () => {
                debugLog('üîÑ Manuelles Aktualisieren der Daten...', 'info');
                loadDashboardData();
            });
        }

        // === CHARTS INITIALISIEREN ===
        function initializeCharts() {
            const ctx = DOM.mainChart.getContext('2d');
            const ctxPortfolio = DOM.portfolioChart.getContext('2d');
            const ctxRSI = DOM.rsiChart.getContext('2d');
            const ctxATR = DOM.atrChart.getContext('2d');
            const ctxVolume = DOM.volumeChart.getContext('2d');
            
            // Hauptchart - Preisentwicklung & Technische Indikatoren
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [], // Zeitstempel
                    datasets: [
                        {
                            label: 'Preis in ‚Ç¨',
                            data: [], // Preis-Daten
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.2)',
                            borderWidth: 2,
                            fill: true
                        },
                        {
                            label: 'RSI',
                            data: [], // RSI-Daten
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.2)',
                            borderWidth: 2,
                            fill: true
                        },
                        {
                            label: 'ATR Volatilit√§t',
                            data: [], // ATR-Daten
                            borderColor: '#48bb78',
                            backgroundColor: 'rgba(72, 187, 120, 0.2)',
                            borderWidth: 2,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                tooltipFormat: 'DD.MM.YYYY',
                                displayFormats: {
                                    day: 'DD.MM.',
                                    month: 'MMM YYYY'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Datum'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Wert in ‚Ç¨'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '‚Ç¨' + value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                                }
                            }
                        }
                    }
                }
            });
            
            // Portfolio Chart - Wertentwicklung
            new Chart(ctxPortfolio, {
                type: 'bar',
                data: {
                    labels: [], // Zeitstempel
                    datasets: [
                        {
                            label: 'Portfolio Wert in ‚Ç¨',
                            data: [], // Portfolio-Wert-Daten
                            backgroundColor: '#667eea',
                            borderColor: '#4a5568',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    return '‚Ç¨' + tooltipItem.raw.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                tooltipFormat: 'DD.MM.YYYY',
                                displayFormats: {
                                    day: 'DD.MM.',
                                    month: 'MMM YYYY'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Datum'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Wert in ‚Ç¨'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '‚Ç¨' + value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                                }
                            }
                        }
                    }
                }
            });
            
            // RSI Chart
            new Chart(ctxRSI, {
                type: 'line',
                data: {
                    labels: [], // Zeitstempel
                    datasets: [
                        {
                            label: 'RSI',
                            data: [], // RSI-Daten
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.2)',
                            borderWidth: 2,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                tooltipFormat: 'DD.MM.YYYY',
                                displayFormats: {
                                    day: 'DD.MM.',
                                    month: 'MMM YYYY'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Datum'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'RSI'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                                }
                            }
                        }
                    }
                }
            });
            
            // ATR Chart
            new Chart(ctxATR, {
                type: 'line',
                data: {
                    labels: [], // Zeitstempel
                    datasets: [
                        {
                            label: 'ATR Volatilit√§t',
                            data: [], // ATR-Daten
                            borderColor: '#48bb78',
                            backgroundColor: 'rgba(72, 187, 120, 0.2)',
                            borderWidth: 2,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                tooltipFormat: 'DD.MM.YYYY',
                                displayFormats: {
                                    day: 'DD.MM.',
                                    month: 'MMM YYYY'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Datum'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'ATR Volatilit√§t'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                                }
                            }
                        }
                    }
                }
            });
            
            // Volume Chart
            new Chart(ctxVolume, {
                type: 'line',
                data: {
                    labels: [], // Zeitstempel
                    datasets: [
                        {
                            label: 'Volumen-Analyse',
                            data: [], // Volumen-Daten
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.2)',
                            borderWidth: 2,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                tooltipFormat: 'DD.MM.YYYY',
                                displayFormats: {
                                    day: 'DD.MM.',
                                    month: 'MMM YYYY'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Datum'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Volumen'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                                }
                            }
                        }
                    }
                }
            });
        }

        // === CHARTS UPDATEN ===
        function updateMainChart(coinData) {
            const ctx = DOM.mainChart.getContext('2d');
            ctx.clearRect(0, 0, DOM.mainChart.width, DOM.mainChart.height);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: coinData.dates,
                    datasets: [
                        {
                            label: 'Preis in ‚Ç¨',
                            data: coinData.prices,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.2)',
                            borderWidth: 2,
                            fill: true
                        },
                        {
                            label: 'RSI',
                            data: coinData.rsi,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.2)',
                            borderWidth: 2,
                            fill: true
                        },
                        {
                            label: 'ATR Volatilit√§t',
                            data: coinData.atr,
                            borderColor: '#48bb78',
                            backgroundColor: 'rgba(72, 187, 120, 0.2)',
                            borderWidth: 2,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                tooltipFormat: 'DD.MM.YYYY',
                                displayFormats: {
                                    day: 'DD.MM.',
                                    month: 'MMM YYYY'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Datum'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Wert in ‚Ç¨'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '‚Ç¨' + value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                                }
                            }
                        }
                    }
                }
            });
        }

        function updatePortfolioChart(coins) {
            const ctx = DOM.portfolioChart.getContext('2d');
            ctx.clearRect(0, 0, DOM.portfolioChart.width, DOM.portfolioChart.height);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(coins).map(coin => coins[coin].dates[0]), // Zeitstempel
                    datasets: [
                        {
                            label: 'Portfolio Wert in ‚Ç¨',
                            data: Object.keys(coins).map(coin => coins[coin].portfolioValues[0]), // Portfolio-Wert-Daten
                            backgroundColor: '#667eea',
                            borderColor: '#4a5568',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    return '‚Ç¨' + tooltipItem.raw.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                tooltipFormat: 'DD.MM.YYYY',
                                displayFormats: {
                                    day: 'DD.MM.',
                                    month: 'MMM YYYY'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Datum'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Wert in ‚Ç¨'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '‚Ç¨' + value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateRSIChart(coinData) {
            const ctx = DOM.rsiChart.getContext('2d');
            ctx.clearRect(0, 0, DOM.rsiChart.width, DOM.rsiChart.height);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: coinData.dates,
                    datasets: [
                        {
                            label: 'RSI',
                            data: coinData.rsi,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.2)',
                            borderWidth: 2,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                tooltipFormat: 'DD.MM.YYYY',
                                displayFormats: {
                                    day: 'DD.MM.',
                                    month: 'MMM YYYY'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Datum'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'RSI'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateATRChart(coinData) {
            const ctx = DOM.atrChart.getContext('2d');
            ctx.clearRect(0, 0, DOM.atrChart.width, DOM.atrChart.height);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: coinData.dates,
                    datasets: [
                        {
                            label: 'ATR Volatilit√§t',
                            data: coinData.atr,
                            borderColor: '#48bb78',
                            backgroundColor: 'rgba(72, 187, 120, 0.2)',
                            borderWidth: 2,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false